<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<title>technical details, natlinkmain</title>
<meta charset="UTF-8">
<meta name="description" content="Natlink and Unimacro, for a Dragon NaturallySpeaking macro facility">
<meta name="keywords" content="Installation, Natlink/Vocola/Unimacro, technical, details, natlinkmain, technical details, Installation Natlink/Vocola/Unimacro">
<meta name="author" content="QH software, training & advies, 2002/2017 (informatie: info at sitegen.nl)">
<link rel="stylesheet" href="../../unimacro.css" type="text/css" title="unimacro.css">
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../unimacroie6.css" type="text/css" title="unimacroie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" href="../../unimacroie7.css" type="text/css" title="unimacroie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" href="../../unimacroie8.css" type="text/css" title="unimacroie8.css">
<![endif]-->
<!--[if IE 9]>
<link rel="stylesheet" href="../../unimacroie9.css" type="text/css" title="unimacroie9.css">
<![endif]-->
<script language="javascript" src="../../unimacro.js" type="text/javascript"></script><link href="/unimacro/favicon.ico" rel="shortcut icon" type="image/x-icon"></head>
<body onload="afterLoad();" onresize="onResize();"><div class="header" id="header"><!-- === start of header === -->

<table border="0" cellpadding="0" cellspacing="0" class="body" width="100%">
<tr><td class="banner">Unimacro</td><td width="30%">&nbsp;</td></tr></table>

<table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td height="15"></td></tr></table>
<div class="topmenuwide"><table border="0" cellspacing="0" class="menu" width="100%"><tr><td align="center" class="topon" height="28" onclick="location='../index.html';" onmouseout="status='';" onmouseover="status='Installation Natlink/Vocola/Unimacro';"><a href="../index.html">Installation Natlink/Vocola/Unimacro</a></td><td class="topspacer" height="28" width="5">&nbsp;</td><td align="center" class="topoff" height="28" onclick="location='../../features/index.html';" onmouseout="status='';" onmouseover="status='Features';"><a href="../../features/index.html">Features</a></td><td class="topspacer" height="28" width="5">&nbsp;</td><td align="center" class="topoff" height="28" onclick="location='../../grammars/index.html';" onmouseout="status='';" onmouseover="status='Grammars';"><a href="../../grammars/index.html">Grammars</a></td><td class="topspacer" height="28" width="5">&nbsp;</td>
<td align="center" class="topoff" height="28" onclick="location='../../aboutunimacro/index.html';" onmouseout="status='';" onmouseover="status='About';"><a href="../../aboutunimacro/index.html">About</a></td></tr></table></div>
<table border="0" cellpadding="0" cellspacing="0" class="navline" width="100%">
<tr><td class="navline"><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td class="navline">&nbsp;<a href="../../index.html">home</a> > <a href="../index.html">installation natlink/vocola/unimacro</a> > <a href="index.html">technical details</a> > natlinkmain</td></tr></table></td></tr></table>

<!-- === end of header === --></div><div class="body" id="divbody"><table cellspacing="0" class="body" width="100%"><tr><td class="leftpart" id="leftpart" width="25%"><table cellspacing="0" class="leftpart" width="100%"><tr><td class="leftmenu" id="leftmenu"><!-- === left menu === -->
<table class="leftmenu" cellspacing="0" width="100%">
<tr><td class="leftoff" colspan="2"><a href="../installationstableversionpython2.html">Installation stable version python2</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../installationexperimentalversionpython3.html">Installation experimental version python3</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../configuration.html">Configuration</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../howtostart.html">How to start</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../logofchanges/index.html">Log of changes</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../problemswithinstallation.html">Problems with installation?</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../problemswithnatlink.html">Problems with NatLink?</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../speechmodel.html">Speech Model</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../inifilestrategy.html">Ini file strategy</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../configureadministratorrights.html">Configure administrator rights</a></td></tr>

<tr><td class="leftoff" colspan="2"><a href="../settinghome/index.html">Setting HOME</a></td></tr>

<tr><td class="lefton" colspan="2"><a href="index.html">Technical details</a></td></tr>
    
<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="natlinkstatus.html">Natlinkstatus</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="natlinkconfigfunctions.html">Natlinkconfigfunctions</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="natlinkcorefunctions.html">Natlinkcorefunctions</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="configuregui.html">configure GUI</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="batchmodeforconfiguration.html">Batch mode for configuration</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="installer.html">Installer</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="natlinkmainvocolamain.html">Natlinkmain_vocola_main</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="lefton">Natlinkmain</td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="natlinkutils.html">Natlinkutils</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="nsformat.html">Nsformat</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="testingnatlink.html">Testing natlink</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="workingwithsubversion/index.html">Working with subversion</a></td></tr>
</table>

<!-- == end of left menu == --></td></tr></table></td><td class="body0" id="body0" width="76%"><table cellspacing="0" class="body" width="100%"><tr><td class="body" id="body" valign="top"><h1>Changes in natlinkmain.py</h1>
<p>Quite a few changes in this basic file in the course of the years.</p>
<ul><li>August 2011: function reorderKeys to influence the order of loading the grammars. Needed for some Unimacro grammars.</li></ul>

<h3>Below the details of the changes:</h3>
<h3>Global variables (see also <a href="../../features/grammarclasses/natlinkutilsqh/index.html">natlinkutilsqh module</a>)</h3>

<table border="1" cellspacing="0" class="table"><tr><th class="TH1" colspan="2"><p>Most of them taken from status (natlinkstatus)</p></th></tr>

<tr><th class="TH1"><p>variable</p></th><th class="TH"><p>meaning</p></th></tr>

<tr><td class="TD1"><p>DNSdirectory</p></td><td class="TD"><p>holds the NatSpeak folder</p></td></tr>

<tr><td class="TD1"><p>DNSversion</p></td><td class="TD"><p>holds the version (5??,6??, 7??, 8, 9) as an integer</p></td></tr>

<tr><td class="TD1"><p>WindowsVersion</p></td><td class="TD"><p>holds the current windows version</p></td></tr>

<tr><td class="TD1"><p>DNSmode</p></td><td class="TD"><p>can hold the mode (1 for dictate, 2 for command etc), not used currently</p></td></tr>

<tr><td class="TD1"><p>language</p></td><td class="TD"><p>the language code of the NatSpeak speech profile (<strong>enx</strong>, <strong>nld</strong> etc) ,</p></td></tr>

<tr><td class="TD1"><p>BaseModel</p></td><td class="TD"><p>the acoustic model of the current user</p></td></tr>

<tr><td class="TD1"><p>BaseTopic</p></td><td class="TD"><p>the topic of the current user (vocabulary)</p></td></tr>

<tr><td class="TD1"><p>checkForGrammarChanges</p></td><td class="TD"><p>set initially 0, can be set to one, see below, but not needed</p></td></tr></table>

<p>&nbsp;</p>
<h3>Some functions of natlinkmain</h3>
<p>(collect values of status through natlinkstatus or (in Unimacro) through wrapper functions in natlinkutilsqh.py)</p>

<table border="1" cellspacing="0" class="table"><tr><th class="TH1" colspan="2"><p>some of the functions are mentioned here, consult the source file also</p></th></tr>

<tr><th class="TH1"><p>function</p></th><th class="TH"><p>comment</p></th></tr>

<tr><td class="TD1"><p>setCheckForGrammarChanges</p></td><td class="TD"><p>Sets the variable checkForGrammarChanges, should be called from the identical function in natlinkutilsqh.  This function is used  in the grammar <strong>control</strong>, see below, that is in other cases probably not needed.</p></td></tr>

<tr><td class="TD1"><p>beginCallback</p></td><td class="TD"><p>An optional parameter <strong>checkAll</strong> is added, and also the value of*checkForGrammarChanges*is checked.  See below,
Also a special arrangement for _vocola_main has been made.</p></td></tr>

<tr><td class="TD1"><p>changeCallbackLoadedModules</p></td><td class="TD"><p>This function ensures an extra <strong>changeCallback</strong> function in each grammar can be called, in order to switch off exclusive modes when the microphone is toggled.  Used presently in the Unimacro grammars <strong>oops</strong>, <strong>control</strong> and <strong>repeat</strong>,</p></td></tr></table>

<p>&nbsp;</p>
<h3>Debug possibilities:</h3>
<p>The following variables at the top of the file can be set to 1, if you want to have more in the back output.  Restart natspeak in that case (this is now in the configuration functions)</p>

<table border="1" cellspacing="0" class="table"><tr><th class="TH1"><p>Variable</p></th><th class="TH"><p>comment</p></th></tr>

<tr><td class="TD1"><p>debugLoad</p></td><td class="TD"><p>Print extra information at load time (can be configured in configuration procedure)</p></td></tr>

<tr><td class="TD1"><p>debugCallback</p></td><td class="TD"><p>Print lots of information at callback time (can be configured in configuration procedure)</p></td></tr>

<tr><td class="TD1"><p>debugTiming</p></td><td class="TD"><p>Print some information when natpython checks for changed global grammar file (not much used, check if you want)</p></td></tr></table>

<p>&nbsp;</p>
<h3>The automatic checking for changed grammars</h3>
<p>This feature has been turned off in this version of natlinkmain!  Originally Joel Gould designed to system to check for changed grammar files at each speech utterance.  This saves a delay of <strong>0.01 to 0.02 seconds</strong> each utterance.</p>

<p>With this version of natlinkmain, only when the microphone toggles, the complete check is performed.</p>

<p>BUT the global variable <strong>checkForGrammarChanges</strong> can be set in the natlinkmain.py file.  The Unimacro grammar <strong>control</strong> sets this variable as soon as you call <strong>edit grammar grammarname</strong> for some grammarname.  So as soon as you call through the Unimacro system that you want to change a grammar file, the automatic checking for grammar files is turned on, through the function <strong>setCheckForGrammarChanges</strong>.</p>

<p>And... if _vocola_main reports changes of user files at beginCallback also the grammars will be checked once.</p>

<p>When the natpython macrosystem restarts, most often when restarting NatSpeak, the automatic checking is switched off again.</p>

<h3>Search order of python modules</h3>
<p>If the userDirectory of NatLink is set (most often Unimacro is on then), this directory is inserted at the front off <strong>sys.path</strong>. When modules are loaded, this directory goes first.</p>
<ul><li>The order of the modules can be hardcoded in the function <em>reorderKeys</em>. See source code.</li><li>The Unimacro grammar "_control" (if present) is loaded last. Because it can then fill the lists with introspection commands in the correct away.</li><li>For some special applications in the grammar _lines the _tasks grammar is called, so _task goes first in the loading order (after _vocola_main)</li></ul>

<h3>Allowed application names</h3>
<p>the regular expression for searching application-specific grammars has been generalised.  I believe all characters can now appear in the programme name, like <strong>++</strong> (in Notepad++). There is one exception: a leading <strong>_</strong> (underscore) as this is for global grammars.</p>

<h3>Order of loading</h3></td></tr></table></td></tr></table></div><div class="footer" id="footer"><!-- === start of footer === -->

<table border="0" cellpadding="0" cellspacing="0" class="bottomline" width="100%">
<tr><td class="navline"><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td class="navline">&nbsp;<a href="../../index.html">home</a> > <a href="../index.html">installation natlink/vocola/unimacro</a> > <a href="index.html">technical details</a> > natlinkmain > <a href="javascript:scrollTo(0,0);">top</a></td></tr></table></td><td class="sitemapbutton" onclick="location='../../sitemap.html#natlinkmain';" onmouseout="status='';" onmouseover="status='go to the sitemap';"><a href="../../sitemap.html#natlinkmain">sitemap</a></td><td class="navline" width="5"></td><td class="emailbutton" onclick="" onmouseout="status='';" onmouseover="status='send e-mail';"><noscript class="underline">q.hoogenboom</noscript>
<script language="javascript" type="text/javascript"><!--
m("antenna.nl", "q.hoogenboom", "information about: natlinkmain", "e-mail");

// --></script>
<noscript class="underline">at&nbsp;antenna.nl</noscript></td><td class="navline" width="5"></td><td class="copyright">&copy;&nbsp;<strong>unimacro</strong>,&nbsp;feb 2021</td><td class="copprintonly">&copy;&nbsp;<strong>unimacro</strong>,&nbsp;feb 2021<br> | a SourceForge Project by Quintijn Hoogenboom, Bart Jan van Os, Frank Olaf Sem-Jacobsen, Doug Ransom.</td></tr></table>

<!-- === end of footer === --></div>
<script language="javascript" type="text/javascript"><!--
function onResizeFunctions(){

bodyHeight(170);

}


function onLoadFunctions(){

onResizeFunctions();


return;
}


// --></script>

</body></html>