<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<title>unimacro, features, grammar classes, IniGrammar, programmer</title>
<meta charset="UTF-8">
<meta name="description" content="SourceForge project for Dragon NaturallySpeaking macro facility">
<meta name="keywords" content="features, grammar, classes, IniGrammar, programmer, grammar classes, general">
<meta name="author" content="QH software, training & advies, 2002/2017 (informatie: info at sitegen.nl)">
<link rel="stylesheet" href="../../../unimacro.css" type="text/css" title="unimacro.css">
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../../unimacroie6.css" type="text/css" title="unimacroie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" href="../../../unimacroie7.css" type="text/css" title="unimacroie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" href="../../../unimacroie8.css" type="text/css" title="unimacroie8.css">
<![endif]-->
<!--[if IE 9]>
<link rel="stylesheet" href="../../../unimacroie9.css" type="text/css" title="unimacroie9.css">
<![endif]-->
<script language="javascript" src="../../../unimacro.js" type="text/javascript"></script><link href="/unimacro/favicon.ico" rel="shortcut icon" type="image/x-icon"></head>
<body onload="afterLoad();" onresize="onResize();"><div class="header" id="header"><!-- === start of header === -->

<table border="0" cellpadding="0" cellspacing="0" class="body" width="100%">
<tr><td class="banner">Unimacro</td><td width="30%">&nbsp;</td></tr></table>

<table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td height="15"></td></tr></table>
<div class="topmenuwide"><table border="0" cellspacing="0" class="menu" width="100%"><tr><td align="center" class="topoff" height="28" onclick="location='../../../installation/index.html';" onmouseout="status='';" onmouseover="status='Installation Natlink/Vocola/Unimacro';"><a href="../../../installation/index.html">Installation Natlink/Vocola/Unimacro</a></td><td class="topspacer" height="28" width="5">&nbsp;</td><td align="center" class="topon" height="28" onclick="location='../../index.html';" onmouseout="status='';" onmouseover="status='Features';"><a href="../../index.html">Features</a></td><td class="topspacer" height="28" width="5">&nbsp;</td><td align="center" class="topoff" height="28" onclick="location='../../../grammars/index.html';" onmouseout="status='';" onmouseover="status='Grammars';"><a href="../../../grammars/index.html">Grammars</a></td><td class="topspacer" height="28" width="5">&nbsp;</td>
<td align="center" class="topoff" height="28" onclick="location='../../../aboutunimacro/index.html';" onmouseout="status='';" onmouseover="status='About';"><a href="../../../aboutunimacro/index.html">About</a></td></tr></table></div>
<table border="0" cellpadding="0" cellspacing="0" class="navline" width="100%">
<tr><td class="navline"><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td class="navline">&nbsp;<a href="../../../index.html">home</a> > <a href="../../index.html">features</a> > <a href="../index.html">grammar classes</a> > <a href="index.html">inigrammar</a> > programmer</td></tr></table></td></tr></table>

<!-- === end of header === --></div><div class="body" id="divbody"><table cellspacing="0" class="body" width="100%"><tr><td class="leftpart" id="leftpart" width="25%"><table cellspacing="0" class="leftpart" width="100%"><tr><td class="leftmenu" id="leftmenu"><!-- === left menu === -->
<table class="leftmenu" cellspacing="0" width="100%">
<tr><td class="leftoff" colspan="3"><a href="../../actions/index.html">Actions</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../numbers/index.html">Numbers and Spoken Forms</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../unimacroandvocola/index.html">Unimacro and Vocola</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../tracing.html">Tracing</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../inifiles.html">Inifiles</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../translations/index.html">Translations</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../cooperationwithvoicecoder/index.html">Cooperation with voicecoder</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../autohotkey/index.html">AutoHotkey</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../unittesting/index.html">Unit testing</a></td></tr>

<tr><td class="lefton" colspan="3"><a href="../index.html">Grammar classes</a></td></tr>
    
<tr><td class="back" width="20">&nbsp;</td><td class="leftoff" colspan="2"><a href="../grammarx.html">grammarX</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff" colspan="2"><a href="../browsablegrammar.html">Browsable Grammar</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="lefton" colspan="2"><a href="index.html">IniGrammar</a></td></tr>
        
<tr><td class="back" width="20">&nbsp;</td><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="use.html">Use</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="back" width="20">&nbsp;</td><td class="lefton">Programmer</td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="back" width="20">&nbsp;</td><td class="leftoff"><a href="functionsforsearching.html">Functions for searching</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff" colspan="2"><a href="../docstringgrammar/index.html">DocstringGrammar</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff" colspan="2"><a href="../natlinkutilsbj.html">Natlinkutilsbj</a></td></tr>

<tr><td class="back" width="20">&nbsp;</td><td class="leftoff" colspan="2"><a href="../natlinkutilsqh/index.html">Natlinkutilsqh</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../globaldictation/index.html">Global dictation</a></td></tr>

<tr><td class="leftoff" colspan="3"><a href="../../monitorfunctions/index.html">Monitorfunctions</a></td></tr>
</table>

<!-- == end of left menu == --></td></tr></table></td><td class="body0" id="body0" width="76%"><table cellspacing="0" class="body" width="100%"><tr><td class="body" id="body" valign="top"><h1>Instructions for the programmers that want to to make grammars based on the IniGrammar class.</h1>

<p>When initialising an instance of an IniGrammar, the following actions are performed:</p>
<ul><li>the method <em>startInifile</em> performs starts the inifile (copies and opens a sample or default if needed)</li><li>set the variable <em>checkForChanges</em> to 0; this variable is only put to 1 when the <em>editGrammar</em> function is called.</li><li>get the inifile, creating this if necessary.</li><li>get the (pronouncable) name</li><li>get the initial on or off state</li><li>set the variable <em>prevModInfo</em> to <em>None</em></li><li>translate the grammar words with the data from the configuration (.ini) file.</li><li>fill the instance variables through the function 'fillInstanceVariables'.</li></ul>

<p>If all went well the variable 'Error' is set to '0'.</p>
<h3>Name</h3>
<p>The name of the grammar (most often set in the grammar definition or in the inifile) can be used to call for info about the grammar or to call the edit mode for the grammar. The name is also displayed in the <strong>show all grammars</strong> window.</p>

<h3>Filling lists</h3>
<p>Grammar lists are automatically filled through the function <strong>fillGrammarLists</strong> at start or at changes of inifile (provided <em>self.checkForChanges</em> is on). This function can be overloaded.</p>

<p>When you want grammar lists filled not through the inifile, but directly in your grammar, you should define here the variable.</p>
<ul><li><strong>iniIgnoreGrammarLists</strong>, being the list name, or a list of list names.</li><li>Another possibility to do this, is overloading the method <em>fillGrammarLists</em> or the method <em>fillList</em>.</li></ul>

<h3>Difference fillInstanceVariables and fillGrammarLists</h3>
<p>The method <em>fillInstanceVariables</em> is run at initialization time of the grammar instance, before the grammar is loaded into NatSpeak. In order to redo this method, it is best to reloaded grammar, by:</p>

<p class="pre">&nbsp;&nbsp;&nbsp;fullPath = natlinkmain.loadedFiles[self.__module__]<br>
&nbsp;&nbsp;&nbsp;natqh.setCheckForGrammarChanges(1)<br>
&nbsp;&nbsp;&nbsp;os.utime(fullPath, None)</p>

<p>At the next utterance the grammar will be reloaded.</p>
<p>The method <em>fillGrammarLists</em> is run at <em>initialize</em> time, after the grammar is loaded into NatSpeak. This method can be rerun, for example when lists have been changed.</p>

<h3>New inifiles</h3>
<p>When initialising the grammar, an inifile is opened, or created when not yet existent.  Some special methods can be overloaded to provide default data for a new inifile.  The following variables are set:</p>
<ul><li>self.ini: the inivars instance that gets the data from the inifile is</li><li>self.inifile: the full path of the ini file: macrosystem folder \ language+__module__.ini</li><li>self.inifileDate: date/time of last modification of inifile</li><li>self.onOrOff: overload from GrammarX, is set to 0 if specified in section general, key "initial on or off = 0"</li><li>self.Error: initially set to 0. Is set to 1 if in the starting phase (mainly in the switchOn method) an error is encountered.  All rules are deactivated, self.Error is only cleared when a new switchOn try is done.</li><li>self.prevModInfo: set to None, used when things I changed inside the gotBegin method.</li><li>self.checkForChanges: initially set to 0, meaning in gotBegin no checking for changes of inifile is done.  When asked for the method self.editInifile, this variable is set to 1, meaning at each call in gotBegin the checkForChanges function is performed.</li><li>The function fillInstanceVariables (default empty, to be overloaded by a user class) is called, in order to set/control variables that remained outside the grammar lists.</li></ul>

<h3>Switching on (or off)</h3>
<p>In the function <em>initialize</em> (of the grammar itself, no default in the grammar classes), after loading the grammar the function self.switchOnOrOff() should be called in order to complete the switching on/off process.  All rules are activated by default.  If an error occurs, all rules are deactivated, but the grammar remains On. Is another behaviour is wanted, the function switchOn should be overloaded in the grammar.</p>

<p>4. In the function gotBegin in the minimal case (as sketched above), you should call:
if self.checkForChanges:
checkForChanges()</p>

<p>Above variable is normally set to 0.  It is changed to 1 in the editInifile method.  After editing the inifile, at each utterance this check is performed.  It is only reset when the grammar is reloaded.</p>

<p>If you want to activate or deactivate rules in gotBegin, or maintain grammar lists here, you should do more work.  Basically use the variable self.prevModInfo, to be ready as quick as possible if the module info didn't change.  Also check for the variable self.Error.</p>

<p>By the way if the grammar is switched off, gotBegin is not entered, it is skipped already in the GrammarX callback method.
After that in the 'gotBegin' function is to</p>

<h3>gramSpec variable</h3>
<p>Because of the possible translations/synonyms that are possible to insert in IniGrammar grammars, some manipulation is done with the <strong>gramSpec</strong> variable, which holds the grammar definition.</p>
<ul><li>gramSpec is the compulsory name for the grammar specification, and the load statement (most often in the initialize function) should have self.gramSpec as parameter:</li></ul>

<p class="pre">&nbsp;&nbsp;&nbsp;&nbsp;def initialize(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.load(self.gramSpec)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if switching on fillGrammarLists, also with lists like {n1-9} or {number1to99}, will be called:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.switchOnOrOff()</p>
<ul><li>The class variable gramSpec can be a string or a list. But if the grammar is translated (or there are synonyms) a copy of the class variable gramSpec is put into self.originalGramSpec,  and converted into a string.</li><li>If the translation/synonym process has changes, the resulting grammar specification is put as a string in <strong>self.gramSpec</strong> (so becomes an instance variable).</li><li>As a consequence changes to be original grammar specification can not be done after the <strong>__init__</strong> function. If you want to add or remove grammar rules, typically because of settings in the general section of the inifile of the grammar, you should add your own <em>_init_</em> function, as is done in the _tasks.py grammar of Unimacro.</li>    <ul>    <li>First the inifile is started  (startIniFile()), resulting in the fillInstanceVariables() function to be called.</li>    <li>Then the wanted action on the gramSpec is done.</li>    <li>Only then the IniGrammar.__init__ is called.</li></ul>
<li>The grammar is NOT automatically loaded again after you change options in the general section of a grammar inifile. Call <strong>switch on grammar_name</strong> or restart Dragon.</li></ul>

<h3>Useful functions at recognition time</h3>
<h3><a href="../../../features/translations/callbacklogic.html">hasCommon</a></h3>

<p>Check if word or words of the recognition match words of the grammar</p></td></tr></table></td></tr></table></div><div class="footer" id="footer"><!-- === start of footer === -->

<table border="0" cellpadding="0" cellspacing="0" class="bottomline" width="100%">
<tr><td class="navline"><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td class="navline">&nbsp;<a href="../../../index.html">home</a> > <a href="../../index.html">features</a> > <a href="../index.html">grammar classes</a> > <a href="index.html">inigrammar</a> > programmer > <a href="javascript:scrollTo(0,0);">top</a></td></tr></table></td><td class="sitemapbutton" onclick="location='../../../sitemap.html#programmer';" onmouseout="status='';" onmouseover="status='go to the sitemap';"><a href="../../../sitemap.html#programmer">sitemap</a></td><td class="navline" width="5"></td><td class="emailbutton" onclick="" onmouseout="status='';" onmouseover="status='send e-mail';"><noscript class="underline">q.hoogenboom</noscript>
<script language="javascript" type="text/javascript"><!--
m("antenna.nl", "q.hoogenboom", "information about: programmer", "e-mail");

// --></script>
<noscript class="underline">at&nbsp;antenna.nl</noscript></td><td class="navline" width="5"></td><td class="copyright">&copy;&nbsp;<strong>unimacro</strong>,&nbsp;sep 2020</td><td class="copprintonly">&copy;&nbsp;<strong>unimacro</strong>,&nbsp;sep 2020<br> | a SourceForge Project by Quintijn Hoogenboom, Bart Jan van Os, Frank Olaf Sem-Jacobsen, Doug Ransom.</td></tr></table>

<!-- === end of footer === --></div>
<script language="javascript" type="text/javascript"><!--
function onResizeFunctions(){

bodyHeight(170);

}


function onLoadFunctions(){

onResizeFunctions();


return;
}


// --></script>

</body></html>